---
title: "Middleware Stack"
description: "Understanding the Middleware Stack."
sidebar:
  order: 14
  label: "Middleware Stack"
  draft: false
---

import { LinkButton } from "@astrojs/starlight/components";
import CautionBox from "../../../components/CautionBox.astro";

## The Checkpoints

You're driving down the highway. You hit a Security Checkpoint. You stop, they check your ID, scan your cargo, and if everything looks good, they wave you through to the next section. **Middleware** functions in Express are exactly like these checkpoints.

They sit between the raw request coming in and the final route handler. They can **turn back the car** (send a response immediately), inspect the trunk (modify `req`), or just wave it through to the next booth (call `next()`).

### Checkpoints on the Express Highway

<img
  src="/assets/lessons/02-server-express-way/04-toll-booth.png"
  alt="A high-tech digital toll booth / security checkpoint. Scanners shooting laser grids over passing data packets."
  width="100%"
/>

_Fig 1: Inspect, Process, Pass._

---

## The next() Function

Middleware functions take **three** arguments: `req`, `res`, and `next`.

`next` is a function that, when called, passes control to the _next_ middleware function in the stack.

<CautionBox>
  <strong>Professor Solo's Directive:</strong>
  <br />
  If you don't call <strong>next()</strong> or send a response, the request
  hangs forever. The driver sits there honking until the connection times out.
  Don't be that guy.
</CautionBox>

---

## Extra Bits & Bytes

<LinkButton
  href="https://expressjs.com/en/guide/using-middleware.html"
  icon="external"
  variant="secondary"
  target="_blank"
>
  Express Middleware Guide
</LinkButton>

<div class="next-step">
  <h3>‚è≠ Custom Checkpoints</h3>
  <p>Let's build our own toll booth.</p>
</div>
