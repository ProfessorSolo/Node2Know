---
title: 'Module Systems (CJS & ESM)'
description: 'Understanding CommonJS vs. ES Modules in Node.js.'
sidebar:
  order: 9
  label: 'Module Systems'
draft: false
---

import { LinkButton, Steps, Aside } from '@astrojs/starlight/components';
import CautionBox from '../../../components/CautionBox.astro';

## The Tale of Two Systems

In the beginning, JavaScript had no official way to share code between files. It was the Wild West. When Node.js was built, it needed a way to manage dependencies, so it adopted **CommonJS (CJS)**. This became the standard for years.

Then came **ES Modules (ESM)**‚Äîthe official, standardized module system for JavaScript, aimed at unifying the browser and the server. Now, Node.js speaks both languages, but they work quite differently.

Think of it like two different logistics companies operating on the same construction site.

### CommonJS (The Legacy Standard)

CommonJS is the "Industrial Supply Chain." It's practical, synchronous, and built for the server.

When you use `require()`, you are filling out a **Requisition Form** and handing it to a clerk who _immediately_ runs to the warehouse, grabs the item, and puts it in your hand before you can do anything else.

- **`require()`**: The order form. It loads the file synchronously.
- **`module.exports`**: The shipping container. Whatever you put in here is what gets shipped.

#### The Requisition (`require`)

<Aside type="caution" title="Blocking Operation">
  `require` is **synchronous**. The script halts until the required file is
  found, read, and executed. This is fine on a server (files are local), but
  terrible in a browser (files are over a network).
</Aside>

```javascript
// ./app.js
// "Go get the http module right now."
const http = require('http');

// "Go get our tools."
const tools = require('./utils');
```

#### The Shipment (`module.exports`)

```javascript
// ./utils.js
const tools = {
  hammer: 'üî®',
  drill: 'üî´',
};

// Pack the container
module.exports = tools;
```

---

### ES Modules (The Modern Standard)

ESM is the "Architectural Blueprint." It's static, asynchronous-friendly, and standardized across the entire JS ecosystem (browsers included).

When you use `import`, you are drawing a dependency line on a blueprint. The engine scans all these lines _before_ running the code to build a complete dependency graph.

- **`import`**: The dependency declaration.
- **`export`**: The public interface.

#### The Blueprint (`import`)

To use ESM in Node, you either need to use the `.mjs` extension or add `"type": "module"` to your `package.json`.

```javascript
// ./app.js
// "I will need these items to function."
import http from 'node:http';
import { hammer } from './utils.js'; // Note the extension!
```

#### The Offerings (`export`)

```javascript
// ./utils.js
export const hammer = 'üî®';
export const drill = 'üî´';

// Or a default export
export default { hammer, drill };
```

---

### The Showdown: CJS vs. ESM

Which one should you use? Here is the breakdown.

| Feature             | CommonJS (CJS)               | ES Modules (ESM)               |
| :------------------ | :--------------------------- | :----------------------------- |
| **Syntax**          | `require` / `module.exports` | `import` / `export`            |
| **Loading**         | Synchronous (Dynamic)        | Asynchronous (Static Analysis) |
| **Top-Level Await** | No (requires async wrapper)  | **Yes** (very distinctive)     |
| **Browser Native?** | No                           | Yes                            |
| **`__dirname`**     | Available                    | Not available (needs polyfill) |
| **Magic**           | `require` can be dynamic     | `import` paths are static      |

<Aside type="tip" title="Pro-Tip">
  Starting a **New Project**? Go **ESM**. It's the future. - working on an
  **Existing Backend**? **CJS** is likely what you'll see. It's not going
  anywhere soon.
</Aside>

<CautionBox>
**Warning:**

You can import CJS into ESM, but you **cannot** `require()` an
ESM file in CJS.

‚úÖ `import module from './commonjs-file.js'` - Works!

‚ùå `require('./esm-file.mjs')` - Crashes! Use `await import()` instead

</CautionBox>

![CommonJS vs ESM Handshake](/assets/lessons/01-intro-to-node/cjs-vs-esm.png)

---

## Extra Bits & Bytes

<LinkButton
  href="https://github.com/ProfessorSolo/Node2Know-ModuleSystems"
  variant="primary"
  icon="external"
  target="_blank"
>
  CommonJS vs ES Modules Demo Repo
</LinkButton>

---

### ‚è≠ File System Freedom with FS

In Node.js, we're free from the sandbox of the browser. We can do (almost) anything we want with folders and files on the server.
